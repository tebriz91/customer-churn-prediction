# Feature Engineering

## Обзор

Этот документ описывает процесс создания и преобразования признаков (feature engineering) для модели прогнозирования оттока клиентов банка.

## Созданные признаки

### 1. Отношение баланса к зарплате (balance_salary_ratio)

- **Описание**: Отношение текущего баланса клиента к его предполагаемой зарплате
- **Формула**: `Balance / (EstimatedSalary + 1)`
- **Обоснование**: Этот признак помогает определить, какую часть своего дохода клиент 
хранит в банке. Низкое значение может указывать на то, что клиент предпочитает 
хранить деньги в другом месте.

### 2. Продукты на год обслуживания (products_per_tenure)

- **Описание**: Среднее количество банковских продуктов на год обслуживания
- **Формула**: `NumOfProducts / (Tenure + 1)`
- **Обоснование**: Показывает интенсивность использования банковских продуктов. 
Высокое значение может указывать на более тесную связь клиента с банком.

### 3. Активность с кредитной картой (active_with_credit_card)

- **Описание**: Взаимодействие между статусом активного клиента и наличием 
кредитной карты
- **Формула**: `IsActiveMember * HasCrCard`
- **Обоснование**: Комбинированный признак, показывающий активных клиентов с 
кредитными картами, что может быть важным индикатором лояльности.

### 4. Возрастные группы (age_group)

- **Описание**: Категоризация клиентов по возрастным группам
- **Группы**: Young, Adult, Middle, Senior
- **Метод**: Квартили по возрасту (pd.qcut)
- **Обоснование**: Разные возрастные группы могут иметь различные паттерны 
поведения и склонность к оттоку.

## Преобразование признаков

### Кодирование категориальных признаков

- **Метод**: One-hot encoding
- **Применяется к**:
  - Gender
  - age_group
- **Особенности**: Используется drop_first=True для избежания мультиколлинеарности

### Масштабирование числовых признаков

- **Метод**: StandardScaler
- **Применяется ко всем числовым признакам**
- **Особенности**: 
  - Обучается только на тренировочных данных
  - Применяется к тестовым данным без повторного обучения

## Технические детали

### Входные данные

- Тренировочный набор: `data/X_train.csv`
- Тестовый набор: `data/X_test.csv`

### Выходные данные

- Обработанный тренировочный набор: `data/X_train_featured.csv`
- Обработанный тестовый набор: `data/X_test_featured.csv`

### Обработка пограничных случаев

- Добавление 1 к знаменателю в расчетах для избежания деления на ноль
- Сохранение оригинальных данных при создании новых признаков
- Проверка на наличие пропущенных значений

## Использование

### Запуск процесса создания признаков

```python
from feature_engineering import FeatureEngineer

# Создание экземпляра класса
fe = FeatureEngineer()

# Создание новых признаков
featured_data = fe.create_features(input_data)

# Масштабирование признаков
train_scaled, test_scaled = fe.scale_features(train_featured, test_featured)
```

### Запуск из командной строки

```bash
python feature_engineering.py
```

## Тестирование

### Запуск тестов

```bash
pytest tests/test_feature_engineering.py
```

### Основные тестовые сценарии

1. Проверка создания новых признаков
2. Проверка корректности масштабирования
3. Проверка работы с тренировочными и тестовыми данными
4. Проверка обработки пограничных случаев

## Мониторинг и логирование

### Уровни логирования

- INFO: основные этапы обработки
- ERROR: ошибки при обработке данных

### Основные события логирования

- Начало создания признаков
- Создание новых признаков
- Начало масштабирования
- Завершение процесса
- Ошибки при обработке

## Рекомендации по улучшению

### Возможные дополнительные признаки

1. Агрегированные признаки по географическим регионам
2. Временные признаки (сезонность, день недели)
3. Взаимодействия между существующими признаками

### Потенциальные улучшения

1. Добавление полиномиальных признаков
2. Использование других методов кодирования категориальных переменных
3. Реализация feature selection для отбора наиболее значимых признаков

## Зависимости

### Основные библиотеки

- pandas>=1.3.0
- numpy>=1.20.0
- scikit-learn>=0.24.0

### Для разработки

- pytest>=6.0.0
- black>=21.0
- flake8>=3.9.0

## Известные ограничения

1. Не обрабатываются временные ряды
2. Ограниченная поддержка категориальных признаков
3. Отсутствие автоматического определения выбросов

## Контрибьюция

1. Форкните репозиторий
2. Создайте ветку для новой функциональности
3. Внесите изменения
4. Отправьте pull request
